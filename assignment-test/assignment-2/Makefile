targets=puzzle1 puzzle2 puzzle3 puzzle4 puzzle1.sol puzzle2.sol puzzle3.sol puzzle4.sol
CFLAGS=-g -O0

.PHONY: all clean

all: $(targets)

puzzle1: STDOUT_WALDO_TARGET=42
puzzle1: STDOUT_WALDO_NUM=3
puzzle1: STDERR_WALDO_TARGET=-1
puzzle1: STDERR_WALDO_NUM=1
puzzle1: FILE_WALDO_TARGET=-1
puzzle1: FILE_WALDO_CONTENTS_NUM=1
puzzle1: FILE_WALDO_NAME_NUM=0
puzzle1: puzzle.c
	gcc $(CFLAGS) -DSTDOUT_WALDO_TARGET=${STDOUT_WALDO_TARGET} \
	    -DSTDOUT_WALDO_NUM=${STDOUT_WALDO_NUM} \
	    -DSTDERR_WALDO_TARGET=${STDERR_WALDO_TARGET} \
	    -DSTDERR_WALDO_NUM=${STDERR_WALDO_NUM} \
	    -DFILE_WALDO_TARGET=${FILE_WALDO_TARGET} \
	    -DFILE_WALDO_CONTENTS_NUM=${FILE_WALDO_CONTENTS_NUM} \
	    -DFILE_WALDO_NAME_NUM=${FILE_WALDO_NAME_NUM} \
	     $< -o $@	

puzzle2: STDOUT_WALDO_TARGET=83
puzzle2: STDOUT_WALDO_NUM=7
puzzle2: STDERR_WALDO_TARGET=83
puzzle2: STDERR_WALDO_NUM=40
puzzle2: FILE_WALDO_TARGET=-1
puzzle2: FILE_WALDO_CONTENTS_NUM=2
puzzle2: FILE_WALDO_NAME_NUM=0
puzzle2: puzzle.c
	gcc $(CFLAGS) -DSTDOUT_WALDO_TARGET=${STDOUT_WALDO_TARGET} \
	    -DSTDOUT_WALDO_NUM=${STDOUT_WALDO_NUM} \
	    -DSTDERR_WALDO_TARGET=${STDERR_WALDO_TARGET} \
	    -DSTDERR_WALDO_NUM=${STDERR_WALDO_NUM} \
	    -DFILE_WALDO_TARGET=${FILE_WALDO_TARGET} \
	    -DFILE_WALDO_CONTENTS_NUM=${FILE_WALDO_CONTENTS_NUM} \
	    -DFILE_WALDO_NAME_NUM=${FILE_WALDO_NAME_NUM} \
	     $< -o $@	

puzzle3: STDOUT_WALDO_TARGET=76
puzzle3: STDOUT_WALDO_NUM=4
puzzle3: STDERR_WALDO_TARGET=16
puzzle3: STDERR_WALDO_NUM=34
puzzle3: FILE_WALDO_TARGET=29
puzzle3: FILE_WALDO_CONTENTS_NUM=19
puzzle3: FILE_WALDO_NAME_NUM=1
puzzle3: puzzle.c
	gcc $(CFLAGS) -DSTDOUT_WALDO_TARGET=${STDOUT_WALDO_TARGET} \
	    -DSTDOUT_WALDO_NUM=${STDOUT_WALDO_NUM} \
	    -DSTDERR_WALDO_TARGET=${STDERR_WALDO_TARGET} \
	    -DSTDERR_WALDO_NUM=${STDERR_WALDO_NUM} \
	    -DFILE_WALDO_TARGET=${FILE_WALDO_TARGET} \
	    -DFILE_WALDO_CONTENTS_NUM=${FILE_WALDO_CONTENTS_NUM} \
	    -DFILE_WALDO_NAME_NUM=${FILE_WALDO_NAME_NUM} \
	     $< -o $@	

puzzle4: STDOUT_WALDO_TARGET=97
puzzle4: STDOUT_WALDO_NUM=4
puzzle4: STDERR_WALDO_TARGET=64
puzzle4: STDERR_WALDO_NUM=33
puzzle4: FILE_WALDO_TARGET=10
puzzle4: FILE_WALDO_CONTENTS_NUM=55
puzzle4: FILE_WALDO_NAME_NUM=1
puzzle4: puzzle.c
	gcc $(CFLAGS) -DSTDOUT_WALDO_TARGET=${STDOUT_WALDO_TARGET} \
	    -DSTDOUT_WALDO_NUM=${STDOUT_WALDO_NUM} \
	    -DSTDERR_WALDO_TARGET=${STDERR_WALDO_TARGET} \
	    -DSTDERR_WALDO_NUM=${STDERR_WALDO_NUM} \
	    -DFILE_WALDO_TARGET=${FILE_WALDO_TARGET} \
	    -DFILE_WALDO_CONTENTS_NUM=${FILE_WALDO_CONTENTS_NUM} \
	    -DFILE_WALDO_NAME_NUM=${FILE_WALDO_NAME_NUM} \
	     $< -o $@	

puzzle1.sol: puzzle1 findwaldo
	./findwaldo $< > $@
	cat $@

puzzle2.sol: puzzle2 findwaldo
	./findwaldo $< > $@
	cat $@

puzzle3.sol: puzzle3 findwaldo
	./findwaldo $< > $@
	cat $@

puzzle4.sol: puzzle4 findwaldo
	./findwaldo $< > $@
	cat $@

clean:
	-rm -f $(wildcard $(targets))
	-rm -rf $(wildcard PuzzleDir stdout stderr *.json)
